<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Noobdye Applications</title>
<style>
  /* Reset básico */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    background: #121212;
    color: #eee;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
  }
  #container {
    max-width: 480px;
    width: 100%;
    background: #1e1e1e;
    border-radius: 12px;
    padding: 25px 30px;
    box-shadow: 0 0 20px #09f;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #0af;
  }
  form {
    margin-bottom: 15px;
  }
  input[type="text"], input[type="email"], input[type="password"], input[type="number"], select {
    width: 100%;
    padding: 10px 12px;
    margin: 8px 0 12px;
    border-radius: 6px;
    border: none;
    font-size: 15px;
  }
  button {
    width: 100%;
    background: #09f;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background: #06c;
  }
  a {
    color: #0af;
    cursor: pointer;
    text-decoration: underline;
  }
  #authContainer > div {
    margin-bottom: 15px;
  }
  .error, .success {
    color: #f66;
    margin-bottom: 12px;
    font-weight: bold;
    text-align: center;
  }
  .success {
    color: #6f6;
  }
  #navButtons {
    display: none;
    justify-content: center;
    margin-bottom: 15px;
  }
  #navButtons button {
    width: auto;
    margin: 0 6px;
    padding: 10px 20px;
  }
  #logoutUserBtn, #logoutAdminBtn {
    background: #c00;
    margin-top: 10px;
  }
  #userPanel, #adminPanel {
    display: none;
  }
  /* Produtos lista */
  #productsList, #productsListAdmin {
    max-height: 140px;
    overflow-y: auto;
    background: #333;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 15px;
  }
  #pixQrCode img {
    display: block;
    margin: 15px auto;
    border-radius: 12px;
  }
  #pixKey {
    text-align: center;
    margin-bottom: 10px;
    cursor: pointer;
    font-weight: bold;
    color: #0af;
    user-select: all;
  }
  /* Form mensagens */
  #addProductMsg, #addProductMsgSuccess, #paymentMsg {
    text-align: center;
    font-weight: bold;
    margin-bottom: 12px;
  }
  #addProductMsg {
    color: #f66;
  }
  #addProductMsgSuccess {
    color: #6f6;
  }
</style>
</head>
<body>
  <div id="container">
    <h1>Noobdye Applications</h1>

    <div id="authContainer">
      <div id="loginFormDiv">
        <form id="loginForm" autocomplete="off">
          <input type="email" id="loginEmail" placeholder="Email" required />
          <input type="password" id="loginPassword" placeholder="Senha" required />
          <button type="submit">Entrar</button>
          <div class="error" id="loginError"></div>
          <p>Não tem conta? <a href="#" id="showRegisterLink">Registrar</a></p>
        </form>
      </div>
      <div id="registerFormDiv" style="display:none;">
        <form id="registerForm" autocomplete="off">
          <input type="text" id="registerName" placeholder="Nome" required />
          <input type="email" id="registerEmail" placeholder="Email" required />
          <input type="password" id="registerPassword" placeholder="Senha" required />
          <button type="submit">Registrar</button>
          <div class="error" id="registerError"></div>
          <div class="success" id="registerSuccess"></div>
          <p>Já tem conta? <a href="#" id="showLoginLink">Entrar</a></p>
        </form>
      </div>
    </div>

    <div id="navButtons" style="display:none;">
      <button id="btnUserPanel">Usuário</button>
      <button id="btnAdminPanel">Admin</button>
    </div>

    <button id="logoutUserBtn" style="display:none;">Sair</button>
    <button id="logoutAdminBtn" style="display:none;">Sair (Admin)</button>

    <!-- Painel Usuário -->
    <div id="userPanel">
      <h2>Loja - Compre com Pix</h2>
      <div id="productsList">Carregando produtos...</div>
      <form id="buyForm">
        <select id="productSelect"></select>
        <button type="submit">Comprar</button>
      </form>
      <h3>Pagamento Pix</h3>
      <div id="pixKey" title="Clique para copiar a chave Pix"></div>
      <div id="pixQrCode"></div>
      <form id="paymentForm">
        <input type="text" id="paymentName" placeholder="Seu nome" required />
        <input type="text" id="paymentTxId" placeholder="ID do pagamento (TXID)" required />
        <button type="submit">Verificar pagamento</button>
      </form>
      <div id="paymentMsg"></div>
    </div>

    <!-- Painel Admin -->
    <div id="adminPanel">
      <h2>Administração de Produtos</h2>
      <div id="productsListAdmin">Carregando produtos...</div>
      <form id="addProductForm">
        <input type="text" id="productNameInput" placeholder="Nome do produto" required />
        <input type="number" id="productQtyInput" placeholder="Quantidade" min="1" required />
        <button type="submit">Adicionar produto</button>
      </form>
      <div id="addProductMsg"></div>
      <div id="addProductMsgSuccess"></div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
  const PIX_KEY = "00020126460014BR.GOV.BCB.PIX0124willianvss0011@gmail.com52040000530398654045.005802BR5921Willian Cabral Aguiar6009Sao Paulo62070503***6304A09A";
  const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1133778983112128398/bQXL0yV3k4qHYa4v16bzOaT3k42oK6zkajQ6D2ByfrPeU-hOgzZKsq41-Uv0kNt6A8Fw";

  function simpleHash(str) {
    let hash = 0;
    for(let i=0; i<str.length; i++) {
      hash = ((hash << 5) - hash) + str.charCodeAt(i);
      hash |= 0;
    }
    return hash.toString();
  }

  function loadUsers() {
    return JSON.parse(localStorage.getItem("users")||"[]");
  }
  function saveUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
  }
  function saveSession(user) {
    localStorage.setItem("session", JSON.stringify(user));
  }
  function loadSession() {
    let s = localStorage.getItem("session");
    return s ? JSON.parse(s) : null;
  }
  function clearSession() {
    localStorage.removeItem("session");
  }
  function loadProducts() {
    return JSON.parse(localStorage.getItem("products")||"[]");
  }
  function saveProducts(products) {
    localStorage.setItem("products", JSON.stringify(products));
  }

  const authContainer = document.getElementById('authContainer');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const loginError = document.getElementById('loginError');
  const registerError = document.getElementById('registerError');
  const registerSuccess = document.getElementById('registerSuccess');
  const showRegisterLink = document.getElementById('showRegisterLink');
  const showLoginLink = document.getElementById('showLoginLink');
  const navButtons = document.getElementById('navButtons');
  const btnUserPanel = document.getElementById('btnUserPanel');
  const btnAdminPanel = document.getElementById('btnAdminPanel');
  const logoutUserBtn = document.getElementById('logoutUserBtn');
  const logoutAdminBtn = document.getElementById('logoutAdminBtn');
  const userPanel = document.getElementById('userPanel');
  const adminPanel = document.getElementById('adminPanel');
  const productsList = document.getElementById('productsList');
  const productsListAdmin = document.getElementById('productsListAdmin');
  const productSelect = document.getElementById('productSelect');
  const buyForm = document.getElementById('buyForm');
  const pixKeyDiv = document.getElementById('pixKey');
  const pixQrCodeDiv = document.getElementById('pixQrCode');
  const paymentForm = document.getElementById('paymentForm');
  const paymentMsg = document.getElementById('paymentMsg');

  const addProductForm = document.getElementById('addProductForm');
  const productNameInput = document.getElementById('productNameInput');
  const productQtyInput = document.getElementById('productQtyInput');
  const addProductMsg = document.getElementById('addProductMsg');
  const addProductMsgSuccess = document.getElementById('addProductMsgSuccess');

  // Usuário Admin hardcoded para simplicidade
  // Email admin: willianwca2011@gmail.com
  function isAdmin(user) {
    return user && user.email.toLowerCase() === "willianwca2011@gmail.com";
  }

  function updateUIOnLogin(user) {
    authContainer.style.display = 'none';
    navButtons.style.display = 'flex';
    logoutUserBtn.style.display = isAdmin(user) ? 'none' : 'block';
    logoutAdminBtn.style.display = isAdmin(user) ? 'block' : 'none';
    userPanel.style.display = isAdmin(user) ? 'none' : 'block';
    adminPanel.style.display = isAdmin(user) ? 'block' : 'none';
    if (isAdmin(user)) {
      btnUserPanel.style.display = 'inline-block';
      btnAdminPanel.style.display = 'inline-block';
    } else {
      navButtons.style.display = 'none';
    }
    loadAndRenderProducts();
    renderPixPaymentSection();
  }
  function updateUIOnLogout() {
    authContainer.style.display = 'block';
    loginError.textContent = "";
    registerError.textContent = "";
    registerSuccess.textContent = "";
    navButtons.style.display = 'none';
    logoutUserBtn.style.display = 'none';
    logoutAdminBtn.style.display = 'none';
    userPanel.style.display = 'none';
    adminPanel.style.display = 'none';
  }

  function loadAndRenderProducts() {
    let products = loadProducts();
    if (products.length === 0) {
      products = [
        {name:"Bot Discord - 1 mês", qty: 10},
        {name:"Pacote Extra RAM", qty: 5},
        {name:"Extensão Premium", qty: 3}
      ];
      saveProducts(products);
    }

    // Render lista para usuário
    productsList.innerHTML = "";
    productSelect.innerHTML = "";
    products.forEach((p,i) => {
      let item = document.createElement("div");
      item.textContent = `${p.name} - Quantidade: ${p.qty}`;
      productsList.appendChild(item);

      let option = document.createElement("option");
      option.value = i;
      option.textContent = p.name + (p.qty <= 0 ? " (Indisponível)" : "");
      option.disabled = p.qty <= 0;
      productSelect.appendChild(option);
    });

    // Render lista admin
    productsListAdmin.innerHTML = "";
    products.forEach((p,i) => {
      let item = document.createElement("div");
      item.textContent = `${p.name} - Quantidade: ${p.qty}`;
      productsListAdmin.appendChild(item);
    });
  }

  function renderPixPaymentSection() {
    pixKeyDiv.textContent = PIX_KEY;
    pixKeyDiv.title = "Clique para copiar a chave Pix";
    // Gerar QR Code
    QRCode.toCanvas(PIX_KEY, {width: 180}, function (error, canvas) {
      if (error) console.error(error);
      pixQrCodeDiv.innerHTML = "";
      pixQrCodeDiv.appendChild(canvas);
    });
  }

  pixKeyDiv.onclick = () => {
    navigator.clipboard.writeText(PIX_KEY).then(() => {
      alert("Chave Pix copiada!");
    });
  };

  // Login
  loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    loginError.textContent = "";
    const email = document.getElementById("loginEmail").value.trim().toLowerCase();
    const password = document.getElementById("loginPassword").value;
    let users = loadUsers();
    const user = users.find(u => u.email === email && u.password === simpleHash(password));
    if (!user) {
      loginError.textContent = "Email ou senha incorretos.";
      return;
    }
    saveSession(user);
    updateUIOnLogin(user);
  });

  // Register
  registerForm.addEventListener("submit", (e) => {
    e.preventDefault();
    registerError.textContent = "";
    registerSuccess.textContent = "";
    const name = document.getElementById("registerName").value.trim();
    const email = document.getElementById("registerEmail").value.trim().toLowerCase();
    const password = document.getElementById("registerPassword").value;
    if (!name || !email || !password) {
      registerError.textContent = "Preencha todos os campos.";
      return;
    }
    let users = loadUsers();
    if (users.find(u => u.email === email)) {
      registerError.textContent = "Email já cadastrado.";
      return;
    }
    users.push({name, email, password: simpleHash(password)});
    saveUsers(users);
    registerSuccess.textContent = "Registro concluído! Você já pode entrar.";
    registerForm.reset();
  });

  showRegisterLink.onclick = (e) => {
    e.preventDefault();
    document.getElementById('loginFormDiv').style.display = 'none';
    document.getElementById('registerFormDiv').style.display = 'block';
  };
  showLoginLink.onclick = (e) => {
    e.preventDefault();
    document.getElementById('registerFormDiv').style.display = 'none';
    document.getElementById('loginFormDiv').style.display = 'block';
  };

  logoutUserBtn.onclick = () => {
    clearSession();
    updateUIOnLogout();
  };
  logoutAdminBtn.onclick = () => {
    clearSession();
    updateUIOnLogout();
  };

  btnUserPanel.onclick = () => {
    userPanel.style.display = 'block';
    adminPanel.style.display = 'none';
  };
  btnAdminPanel.onclick = () => {
    userPanel.style.display = 'none';
    adminPanel.style.display = 'block';
  };

  // Comprar produto - só diminui a quantidade e mostra QR Pix (não integra com API real)
  buyForm.addEventListener("submit", (e) => {
    e.preventDefault();
    let products = loadProducts();
    let idx = productSelect.value;
    if (idx === "" || products[idx].qty <= 0) {
      alert("Produto indisponível");
      return;
    }
    // Diminuir quantidade
    products[idx].qty--;
    saveProducts(products);
    loadAndRenderProducts();
    alert(`Produto "${products[idx].name}" selecionado. Faça o pagamento usando a chave Pix.`);
  });

  // Verificar pagamento (simulação) e enviar mensagem para Discord
  paymentForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    paymentMsg.textContent = "";
    const nome = document.getElementById("paymentName").value.trim();
    const txid = document.getElementById("paymentTxId").value.trim();

    if (!nome || !txid) {
      paymentMsg.style.color = "#f66";
      paymentMsg.textContent = "Preencha nome e ID do pagamento (TXID).";
      return;
    }

    // Simular verificação e enviar mensagem ao Discord
    try {
      const data = {
        content: `Novo pagamento recebido!\nNome: ${nome}\nTXID: ${txid}\nChave Pix: ${PIX_KEY}`
      };
      const res = await fetch(DISCORD_WEBHOOK_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });
      if (res.ok) {
        paymentMsg.style.color = "#6f6";
        paymentMsg.textContent = "Pagamento verificado e registrado no Discord.";
        paymentForm.reset();
      } else {
        throw new Error("Erro ao enviar mensagem para Discord");
      }
    } catch (err) {
      paymentMsg.style.color = "#f66";
      paymentMsg.textContent = "Erro ao registrar pagamento. Tente novamente.";
      console.error(err);
    }
  });

  // Admin adiciona produto
  addProductForm.addEventListener("submit", (e) => {
    e.preventDefault();
    addProductMsg.textContent = "";
    addProductMsgSuccess.textContent = "";
    const name = productNameInput.value.trim();
    const qty = parseInt(productQtyInput.value);
    if (!name || isNaN(qty) || qty < 1) {
      addProductMsg.textContent = "Preencha nome e quantidade válidos.";
      return;
    }
    let products = loadProducts();
    let existing = products.find(p => p.name.toLowerCase() === name.toLowerCase());
    if (existing) {
      existing.qty += qty;
    } else {
      products.push({name, qty});
    }
    saveProducts(products);
    addProductMsgSuccess.textContent = `Produto "${name}" adicionado/atualizado com sucesso!`;
    productNameInput.value = "";
    productQtyInput.value = "";
    loadAndRenderProducts();
  });

  // Inicialização
  let sessionUser = loadSession();
  if (sessionUser) {
    updateUIOnLogin(sessionUser);
  } else {
    updateUIOnLogout();
  }
</script>
</body>
          </html>
